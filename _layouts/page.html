---
layout: default
---
<script type="text/javascript">
    //Get parameters
    var parameters = {};
    var key = window.location.search.substring(1);
    var vars = key.split("&");
    for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split("=");
        if (typeof parameters[pair[0]] === "undefined") {
            parameters[pair[0]] = pair[1];
        } else if (typeof parameters[pair[0]] === "string") {
            var arr = [parameters[pair[0]], pair[1]];
            parameters[pair[0]] = arr;
        } else {
            parameters[pair[0]].push(pair[1]);
        }
    }

    //Get entries
    var contentType;
    var url = 'https://cdn.contentful.com/spaces/x63mv991hgep/entries?access_token=2568c3311665ce63b835b7818f369ee6535d6fe5da4f15112f061cacf986227c&order=fields.order,-sys.createdAt&content_type=';
    if (parameters.query) {
        contentType = 'faq';
        url += contentType + '&query=' + parameters.query;
    } else {
        contentType = '{{page.url | replace: '/', ''}}';
        contentType = contentType.replace('.html', "");
        url += contentType;
    }
    
    fetch(url)
        .then(response => response.json())
        .then(function(entries) {
            var categories = {};
            var category;
            entries.items.forEach(function(item) {
                category = item.fields.category;
                if (!categories[category]) {
                    categories[category] = [];
                }
                categories[category].push({
                    "title": item.fields.title,
                    "id": item.sys.id
                });
            })

            //Build sidebar
            var id;
            var html = "";
            for (category in categories) {
                if (!id) id = categories[category][0].id;
                html += "<li><a class=\"folder\" href=\"#\">" + category + "</a><ul style=\"display: none;\">"
                for (var item of categories[category]) {
                    html += "<li><a href=\"javascript:getEntry('" + item.id + "');\">" + item.title + "</a></li>"
                }
                html += "</ul></li>";
            }

            document.getElementById('sidebar').innerHTML = html;
            if (parameters.query) document.getElementById('search').value = decodeURI(parameters.query);

            getEntry(parameters.id || id);

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#sidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#sidebar").navgoco('toggle', true);
            });
        })

    //Get entry
    function getEntry(id) {
        fetch('https://cdn.contentful.com/spaces/x63mv991hgep/entries/' + id + '?access_token=2568c3311665ce63b835b7818f369ee6535d6fe5da4f15112f061cacf986227c')
            .then(response => response.json())
            .then(function(entry) {
                document.getElementById('title').innerHTML = entry.fields.title;
                document.getElementById('content').innerHTML = marked(entry.fields.content.replace(/\n/g, "<br>"));

                $("li").each(function(index) {
                    if ($(this).text().indexOf(entry.fields.title) > -1) {
                        $(this).attr('class', 'active');
                    } else {
                        $(this).attr('class', '');
                    }
                });

                $("#sidebar").navgoco({
                    caretHtml: '',
                    accordion: true,
                    openClass: 'active',
                    save: false, // leave false or nav highlighting doesn't work right
                    cookie: {
                        name: 'navgoco',
                        expires: false,
                        path: '/'
                    },
                    slide: {
                        duration: 400,
                        easing: 'swing'
                    }
                });
            });
    }

</script>
<nav class="navbar navbar-inverse fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header" style="float:left">
            <a class="navbar-brand" href="/"><img src="/images/logo-dark.svg" class="logo"></a>
        </div>
        <div id="search-container">
            <form action="/faq">
                <input type="text" id="search" name="query" placeholder="도움말 검색">
            </form>
        </div>
    </div>
</nav>
<div class="container">
    <div class="row">
        <div class="col-md-3">
            <ul id="sidebar" class="nav">
            </ul>
        </div>
        <div class="col-md-9 padding-bottom">
            <div class="post-header">
                <h2 id="title" class="post-title-main"></h2>
            </div>
            <div id="content">
            </div>
        </div>
    </div>
</div>
